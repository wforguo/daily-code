(window["vue2-app"]=window["vue2-app"]||[]).push([["AmapDrop"],{"689d":function(t,n,i){},d0c7:function(t,n,i){"use strict";i("689d")},e64a:function(t,n,i){"use strict";i.r(n);var e=function(){var t=this;t._self._c;return t._m(0)},a=[function(){var t=this,n=t._self._c;return n("div",{attrs:{id:"map"}},[n("div",{attrs:{id:"container"}}),n("div",{attrs:{id:"loading"}},[t._v("加载中...")])])}],o=i("8fa8"),r=i("f82f"),c=(i("6e85"),i("faea"),i("1b5b"),i("1ef9"),i("5fda"),i("01e5"),i("5445"),null),l={name:"AmapDrop",title:"高德地图下钻",data:function(){return{}},mounted:function(){var t=this;this.$nextTick((function(){t.init()}))},destroyed:function(){c=null},methods:{init:function(){c=new AMap.Map("container",{resizeEnable:!1,center:[106.889724,35.086912],zoom:4});var t=document.getElementById("loading"),n=[],i=[],e=["#f04864","#facc14","#2fc25b","#1890ff","#8543e0"];function a(){i.length>0&&c.remove(i),n.length>0&&c.remove(n),n=[],i=[]}function l(t,n){return Math.floor(Math.random()*(n-t))+t}function s(t){try{for(var n=t.length,i=0,e=0,a=0,o=0;o<t.length;o++)if(""!=t[o]){var r=t[o],c=void 0,s=void 0,d=void 0,u=void 0,f=void 0;s=parseFloat(r[0])*Math.PI/180,c=parseFloat(r[1])*Math.PI/180,d=Math.cos(c)*Math.cos(s),u=Math.cos(c)*Math.sin(s),f=Math.sin(c),i+=d,e+=u,a+=f}i/=n,e/=n,a/=n;var v=Math.atan2(e,i),h=Math.atan2(a,Math.sqrt(i*i+e*e)),p=.01*l(2,12),m=.01*l(3,12);return[180*v/Math.PI+p,180*h/Math.PI+m]}catch(y){console.warn("获取中心坐标失败"),console.log(y)}}var d={},u=function(t,i){var e=new AMap.Polygon({strokeWeight:2,path:t,fillOpacity:.4,clickable:!1,fillColor:i,strokeColor:i,lineJoin:"round"});n.push(e)},f=function(t){var n=t.name,e=void 0===n?"":n,a=t.count,o=void 0===a?0:a,r=t.center,s=void 0===r?[]:r,d=t.color,u=void 0===d?"#111":d,f=new AMap.Marker({content:"<div class='area-map-marker' style='color: ".concat(u,"'>\n                      <div class='area-map-marker__title' style='font-weight: bold;'>").concat(e,"</div>\n                      <div class='area-map-marker__count'>").concat(o||l(100,1e4),"</div>\n                      <div class='area-map-marker__title'>").concat(t.children?"我可以下钻":"","</div>\n                    </div>"),anchor:"center",draggable:!1,cursor:"pointer",position:s,extData:t,zIndex:1e3});i.push(f),t.children&&f.on("mousedown",(function(t){v(t)})),f.setMap(c)},v=function(t){var n=t.target.De.extData,i=n.level,e=n.id;p(e,i+1)},h=function(n){var i=n.id,e=n.level;return console.log(i,e),new Promise((function(n,a){if(!(e>4))return 3===e&&2!=i?(t.style.visibility="hidden",!1):void fetch("/data/areaList-".concat(e,".json")).then((function(t){return t.json()})).then((function(t){n(t)}))["catch"]((function(n){a(n),t.style.visibility="hidden"}));t.style.visibility="hidden"}))},p=function(i){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;t.style.visibility="visible",h({id:i,level:l}).then((function(i){a(),i.map((function(t,n){var i=[];if(t.areaIdList.map((function(t){if(d[t]){var a=JSON.parse(JSON.stringify(d[t]));a.map((function(t){i=[].concat(Object(r["a"])(i),Object(r["a"])(t)),u(JSON.parse(JSON.stringify(t)),e[n%5])}))}})),i.length>0){var a=s(i);f(Object(o["a"])(Object(o["a"])({},t),{},{center:a,color:e[n%5]}))}})),t.style.visibility="hidden",c.add(n),c.setFitView(n)}),(function(){t.style.visibility="hidden"}))},m=function(){return t.style.visibility="visible",new Promise((function(n,i){fetch("/data/areaPath.json").then((function(t){return t.json()})).then((function(t){d=t,p(),n(t)}))["catch"]((function(n){i(n),t.style.visibility="hidden"}))}))};m()}}},s=l,d=(i("d0c7"),i("0abc")),u=Object(d["a"])(s,e,a,!1,null,null,null);n["default"]=u.exports}}]);
//# sourceMappingURL=AmapDrop.843ea674.js.map