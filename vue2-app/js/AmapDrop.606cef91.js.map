{"version":3,"sources":["webpack://vue2-app-[name]/./src/views/AmapDrop/index.vue?3ccb","webpack://vue2-app-[name]/./node_modules/.pnpm/registry.npmmirror.com+core-js@3.26.1/node_modules/core-js/modules/es.parse-float.js","webpack://vue2-app-[name]/./src/views/AmapDrop/index.vue","webpack://vue2-app-[name]/src/views/AmapDrop/index.vue","webpack://vue2-app-[name]/./src/views/AmapDrop/index.vue?7112","webpack://vue2-app-[name]/./src/views/AmapDrop/index.vue?49c7","webpack://vue2-app-[name]/./node_modules/.pnpm/registry.npmmirror.com+core-js@3.26.1/node_modules/core-js/internals/number-parse-float.js"],"names":["$","$parseFloat","global","forced","parseFloat","render","_vm","this","_self","_c","_m","staticRenderFns","attrs","_v","name","title","data","mounted","destroyed","map","methods","init","resizeEnable","center","zoom","polygons","markers","Y","Z","lng","x","y","z","lat","X","console","strokeWeight","path","fillOpacity","clickable","fillColor","strokeColor","lineJoin","count","color","content","item","anchor","draggable","cursor","position","extData","zIndex","marker","handleAreaClick","id","getUnderMap","level","$loading","fetch","then","resolve","reject","getAreaList","clearMap","res","areaPath","addPolygon","renderMarker","areaPaths","getAreaPath","component","fails","uncurryThis","toString","trim","whitespaces","charAt","Symbol","ITERATOR","iterator","FORCED","Infinity","Object","module","exports","string","trimmedString","result"],"mappings":"8HAAA,W,uBCAA,IAAIA,EAAI,EAAQ,QACZC,EAAc,EAAQ,QAI1BD,EAAE,CAAEE,QAAQ,EAAMC,OAAQC,YAAcH,GAAe,CACrDG,WAAYH,K,gECNd,IAAII,EAAS,WAAkB,IAAIC,EAAIC,KAAQD,EAAIE,MAAMC,GAAG,OAAOH,EAAII,GAAG,IAEtEC,EAAkB,CAAC,WAAY,IAAIL,EAAIC,KAAKE,EAAGH,EAAIE,MAAMC,GAAG,OAAOA,EAAG,MAAM,CAACG,MAAM,CAAC,GAAK,QAAQ,CAACH,EAAG,MAAM,CAACG,MAAM,CAAC,GAAK,eAAeH,EAAG,MAAM,CAACG,MAAM,CAAC,GAAK,YAAY,CAACN,EAAIO,GAAG,gB,wBCYrL,G,sEAAA,MACe,GACfC,gBACAC,eACAC,gBACA,UAEAC,mBAAA,WACA,2BACA,aAGAC,qBACAC,QAEAC,SACAC,gBAKAF,4BAGAG,gBACAC,8BACAC,SAEA,yCAGA,KAEA,KACA,sDAGA,aACA,YACAL,YAEA,YACAA,YAEAM,KACAC,KAMA,gBACA,yCAQA,cACA,IAKA,IAJA,eACA,IACAC,IACAC,IACA,mBACA,aAGA,WACA,SAAAC,SAAAC,SAAAC,SAAAC,SACAH,+BACAI,+BACAH,0BACAC,0BACAC,cACAE,KACAP,KACAC,KAEAM,KACAP,KACAC,KAEA,sBACA,mCAGA,cACA,cACA,wCACA,SACAO,yBACAA,gBAOA,SAOA,gBAGA,wBACAC,eACAC,OACAC,eACAC,aACAC,YACAC,cACAC,mBAEAjB,WAQA,cACA,aAAAX,kBAAA,UAAA6B,iBAAA,WAAApB,kBAAA,UAAAqB,sBAIA,mBACAC,mKACA/B,+EACA6B,2FACAG,4DAEAC,gBACAC,aACAC,iBACAC,WACAC,UACAC,aAEA1B,UACA,YAEA2B,8BACAC,QAGAD,aAIA,cACA,0BACA,UAAAE,OACAC,UAQA,yBAAAC,UAEA,OADAtB,iBACA,2BACA,UAIA,oBAEAuB,6BACA,QAEAC,0CACAC,kBAAA,mBACAA,kBACAC,QACA,UACA,YACAC,KACAJ,+BAfAA,gCAqBA,6EACAA,6BAEAK,GACAR,KACAE,UACA,MACA,YACAO,IACAC,qBACA,SAiBA,GAhBAnB,8BACA,SACA,uCACAoB,mBACAhB,iDAQAiB,+CAIA,YAEA,WACAC,mCACAtB,OACAvB,SACAqB,oBAIAc,4BAGAvC,SAMAA,mBAEA,WACAuC,gCAMA,aAEA,OADAA,6BACA,2BACAC,4BACAC,kBAAA,mBACAA,kBACAS,IAEAb,IACAK,QACA,UACA,YACAC,KACAJ,mCAIAY,OCvRmvB,I,wBCQ/uBC,EAAY,eACd,EACAlE,EACAM,GACA,EACA,KACA,KACA,MAIa,aAAA4D,E,8BCnBf,IAAIrE,EAAS,EAAQ,QACjBsE,EAAQ,EAAQ,QAChBC,EAAc,EAAQ,QACtBC,EAAW,EAAQ,QACnBC,EAAO,EAAQ,QAA4BA,KAC3CC,EAAc,EAAQ,QAEtBC,EAASJ,EAAY,GAAGI,QACxB5E,EAAcC,EAAOE,WACrB0E,EAAS5E,EAAO4E,OAChBC,EAAWD,GAAUA,EAAOE,SAC5BC,EAAS,EAAIhF,EAAY2E,EAAc,SAAWM,KAEhDH,IAAaP,GAAM,WAAcvE,EAAYkF,OAAOJ,OAI1DK,EAAOC,QAAUJ,EAAS,SAAoBK,GAC5C,IAAIC,EAAgBZ,EAAKD,EAASY,IAC9BE,EAASvF,EAAYsF,GACzB,OAAkB,IAAXC,GAA4C,KAA5BX,EAAOU,EAAe,IAAa,EAAIC,GAC5DvF","file":"js/AmapDrop.606cef91.js","sourcesContent":["export * from \"-!../../../node_modules/.pnpm/registry.npmmirror.com+mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/.pnpm/registry.npmmirror.com+css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/.pnpm/registry.npmmirror.com+vue-loader@15.10.1_sqwtrzbl6s4ypz4dmnoirtpj7i/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/.pnpm/registry.npmmirror.com+postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/.pnpm/registry.npmmirror.com+sass-loader@10.4.1_sass@1.56.2+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/.pnpm/registry.npmmirror.com+cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/registry.npmmirror.com+vue-loader@15.10.1_sqwtrzbl6s4ypz4dmnoirtpj7i/node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=4f79ef9e&prod&lang=scss&\"","var $ = require('../internals/export');\nvar $parseFloat = require('../internals/number-parse-float');\n\n// `parseFloat` method\n// https://tc39.es/ecma262/#sec-parsefloat-string\n$({ global: true, forced: parseFloat != $parseFloat }, {\n  parseFloat: $parseFloat\n});\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _vm._m(0)\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',{attrs:{\"id\":\"map\"}},[_c('div',{attrs:{\"id\":\"container\"}}),_c('div',{attrs:{\"id\":\"loading\"}},[_vm._v(\"加载中...\")])])\n}]\n\nexport { render, staticRenderFns }","<!--\n * @Name: index.vue\n * @Author: forguo\n * @Date: 2022/12/11 15:42\n * @Description: index\n-->\n<template>\n    <div id=\"map\">\n        <div id=\"container\"></div>\n        <div id=\"loading\">加载中...</div>\n    </div>\n</template>\n\n<script>\nlet map = null\nexport default {\n    name: 'AmapDrop',\n    title: '高德地图下钻',\n    data() {\n        return {}\n    },\n    mounted() {\n        this.$nextTick(() => {\n            this.init()\n        })\n    },\n    destroyed() {\n        map = null\n    },\n    methods: {\n        init() {\n            /**\n             * 地图初始化\n             */\n            // eslint-disable-next-line no-undef\n            map = new AMap.Map('container', {\n                // zoomEnable:false, // 禁止缩放\n                // dragEnable: false, // 禁止拖拽\n                resizeEnable: false,\n                center: [106.889724, 35.086912], // 地图中心点\n                zoom: 4 // 地图显示的缩放级别\n            })\n            let $loading = document.getElementById('loading')\n\n            // 尺量图集合\n            let polygons = []\n            // marker集合\n            let markers = []\n            let mapColors = ['#f04864', '#facc14', '#2fc25b', '#1890ff', '#8543e0']\n\n            // 情况地图marker及尺量图\n            function clearMap() {\n                if (markers.length > 0) {\n                    map.remove(markers)\n                }\n                if (polygons.length > 0) {\n                    map.remove(polygons)\n                }\n                polygons = []\n                markers = []\n            }\n\n            /**\n             * 获取随机数\n             */\n            function getRandomNum(min, max) {\n                return Math.floor(Math.random() * (max - min)) + min\n            }\n\n            /**\n             * @desc 返回中心点的[经度，纬度]\n             * @param points  points = [[经度，纬度], [经度，纬度]]; 参数数组points的每一项为每一个点的：[经度,纬度]\n             * @returns {number[]} 返回中心点的数组[经度，纬度]\n             */\n            function getPointsCenter(points) {\n                try {\n                    let point_num = points.length // 坐标点个数\n                    let X = 0,\n                        Y = 0,\n                        Z = 0\n                    for (let i = 0; i < points.length; i++) {\n                        if (points[i] == '') {\n                            continue\n                        }\n                        let point = points[i]\n                        let lat, lng, x, y, z\n                        lng = (parseFloat(point[0]) * Math.PI) / 180\n                        lat = (parseFloat(point[1]) * Math.PI) / 180\n                        x = Math.cos(lat) * Math.cos(lng)\n                        y = Math.cos(lat) * Math.sin(lng)\n                        z = Math.sin(lat)\n                        X += x\n                        Y += y\n                        Z += z\n                    }\n                    X = X / point_num\n                    Y = Y / point_num\n                    Z = Z / point_num\n\n                    let tmp_lng = Math.atan2(Y, X)\n                    let tmp_lat = Math.atan2(Z, Math.sqrt(X * X + Y * Y))\n\n                    // 经纬度分别小数点后2位加随机数，防止Marker完全重叠\n                    let x = getRandomNum(2, 12) * 0.01\n                    let y = getRandomNum(3, 12) * 0.01\n                    return [(tmp_lng * 180) / Math.PI + x, (tmp_lat * 180) / Math.PI + y]\n                } catch (e) {\n                    console.warn('获取中心坐标失败')\n                    console.log(e)\n                }\n            }\n\n            /**\n             * 需要绘制的经纬度数据源\n             */\n            let areaPaths = {}\n\n            /**\n             * 构造多边形对象\n             * @param path 多边形轮廓线的节点坐标数组\n             * @param color\n             */\n            let addPolygon = function (path, color) {\n                // 用于在地图上绘制线、面等矢量地图要素的类型\n                // eslint-disable-next-line no-undef\n                let polygon = new AMap.Polygon({\n                    strokeWeight: 2, // 线条宽度，默认为 1\n                    path: path, // 多边形轮廓线的节点坐标数组\n                    fillOpacity: 0.4,\n                    clickable: false,\n                    fillColor: color, // 多边形填充颜色\n                    strokeColor: color, // 线条颜色\n                    lineJoin: 'round' // 折线拐点的绘制样式，默认值为'miter'尖角，其他可选值：'round'圆角、'bevel'斜角\n                })\n                polygons.push(polygon)\n            }\n\n            /**\n             * 自定义marker内容\n             * @param item { name: '', count: '', center: []}\n             * @returns {string}\n             */\n            let renderMarker = function (item) {\n                const { name = '', count = 0, center = [], color = '#111' } = item\n\n                // 创建纯文本标记\n                // eslint-disable-next-line no-undef\n                let marker = new AMap.Marker({\n                    content: `<div class='area-map-marker' style='color: ${color}'>\n                      <div class='area-map-marker__title' style='font-weight: bold;'>${name}</div>\n                      <div class='area-map-marker__count'>${count || getRandomNum(100, 10000)}</div>\n                      <div class='area-map-marker__title'>${item.children ? '我可以下钻' : ''}</div>\n                    </div>`,\n                    anchor: 'center', // 设置文本标记锚点\n                    draggable: false,\n                    cursor: 'pointer',\n                    position: center,\n                    extData: item,\n                    zIndex: 1000\n                })\n                markers.push(marker)\n                if (item.children) {\n                    // 通过点击实现地图下钻\n                    marker.on('mousedown', e => {\n                        handleAreaClick(e)\n                    })\n                }\n                marker.setMap(map)\n            }\n\n            // 点击marker，实现下钻\n            let handleAreaClick = function (e) {\n                const data = e.target.De.extData\n                const { level, id } = data\n                getUnderMap(id, level + 1)\n            }\n\n            /**\n             * 接口mock\n             * @param id\n             * @param level\n             */\n            let getAreaList = function ({ id, level }) {\n                console.log(id, level)\n                return new Promise((resolve, reject) => {\n                    if (level > 4) {\n                        $loading.style.visibility = 'hidden'\n                        return\n                    }\n                    if (level === 3 && id != 2) {\n                        // 只返回华东科数据\n                        $loading.style.visibility = 'hidden'\n                        return false\n                    }\n                    fetch(`data/areaList-${level}.json`)\n                        .then(response => response.json())\n                        .then(data => {\n                            resolve(data)\n                        })\n                        .catch(err => {\n                            reject(err)\n                            $loading.style.visibility = 'hidden'\n                        })\n                })\n            }\n\n            // 默认从科室层级开始\n            let getUnderMap = function (id, level = 2) {\n                $loading.style.visibility = 'visible'\n                // 接口获取\n                getAreaList({\n                    id,\n                    level\n                }).then(\n                    res => {\n                        clearMap()\n                        res.map((item, index) => {\n                            let position = []\n                            item.areaIdList.map(areaId => {\n                                if (areaPaths[areaId]) {\n                                    let areaPath = JSON.parse(JSON.stringify(areaPaths[areaId]))\n                                    areaPath.map(path => {\n                                        position = [...position, ...path]\n                                        /**\n                                         * tips：小细节，\n                                         * 每个小区域都需要用尺量图绘制，一起绘制是可以的，但是后面地图的自适应就不好使了\n                                         * 遍历每个小区域并绘制\n                                         * @param path 多边形轮廓线的节点坐标数组\n                                         */\n                                        // 颜色根据业务需要替换计算方法，这里为了简单使用了下标\n                                        addPolygon(JSON.parse(JSON.stringify(path)), mapColors[index % 5])\n                                    })\n                                }\n                            })\n                            if (position.length > 0) {\n                                // 获取中心点坐标，并渲染区域名称及数据marker\n                                let center = getPointsCenter(position)\n                                renderMarker({\n                                    ...item,\n                                    center,\n                                    color: mapColors[index % 5]\n                                })\n                            }\n                        })\n                        $loading.style.visibility = 'hidden'\n\n                        // 渲染尺量图到地图\n                        map.add(polygons)\n\n                        /**\n                         * tips：小细节，\n                         * 绘制完成之后，做个窗口自适应\n                         */\n                        map.setFitView(polygons)\n                    },\n                    () => {\n                        $loading.style.visibility = 'hidden'\n                    }\n                )\n            }\n\n            // 获取所有的经纬度集合\n            let getAreaPath = function () {\n                $loading.style.visibility = 'visible'\n                return new Promise((resolve, reject) => {\n                    fetch('data/areaPath.json')\n                        .then(response => response.json())\n                        .then(data => {\n                            areaPaths = data\n                            // 获取第一级数据\n                            getUnderMap()\n                            resolve(data)\n                        })\n                        .catch(err => {\n                            reject(err)\n                            $loading.style.visibility = 'hidden'\n                        })\n                })\n            }\n            getAreaPath()\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\">\n#map {\n    height: calc(100vh - 46px);\n}\n#container {\n    width: 100%;\n    height: 100%;\n}\n#loading {\n    position: fixed;\n    z-index: 999;\n    width: 100%;\n    height: 100%;\n    left: 0;\n    right: 0;\n    top: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 16px;\n    color: #333;\n    background: rgba(255, 255, 255, 0.8);\n}\n.area-map-marker {\n    padding: 0.4rem 1rem;\n    border-radius: 0.2rem;\n    background-color: white;\n    border-width: 0;\n    box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.5);\n    text-align: center;\n    font-size: 14px;\n    color: #111;\n}\n.area-map-marker__title,\n.area-map-marker__count {\n    white-space: nowrap;\n}\n</style>\n","import mod from \"-!../../../node_modules/.pnpm/registry.npmmirror.com+cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/.pnpm/registry.npmmirror.com+thread-loader@2.1.3_webpack@4.46.0/node_modules/thread-loader/dist/cjs.js!../../../node_modules/.pnpm/registry.npmmirror.com+babel-loader@8.3.0_em3sh5kto35xuanci4cvhzqfay/node_modules/babel-loader/lib/index.js!../../../node_modules/.pnpm/registry.npmmirror.com+cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/registry.npmmirror.com+vue-loader@15.10.1_sqwtrzbl6s4ypz4dmnoirtpj7i/node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/.pnpm/registry.npmmirror.com+cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/.pnpm/registry.npmmirror.com+thread-loader@2.1.3_webpack@4.46.0/node_modules/thread-loader/dist/cjs.js!../../../node_modules/.pnpm/registry.npmmirror.com+babel-loader@8.3.0_em3sh5kto35xuanci4cvhzqfay/node_modules/babel-loader/lib/index.js!../../../node_modules/.pnpm/registry.npmmirror.com+cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/registry.npmmirror.com+vue-loader@15.10.1_sqwtrzbl6s4ypz4dmnoirtpj7i/node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=4f79ef9e&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=4f79ef9e&prod&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/.pnpm/registry.npmmirror.com+vue-loader@15.10.1_sqwtrzbl6s4ypz4dmnoirtpj7i/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var global = require('../internals/global');\nvar fails = require('../internals/fails');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar toString = require('../internals/to-string');\nvar trim = require('../internals/string-trim').trim;\nvar whitespaces = require('../internals/whitespaces');\n\nvar charAt = uncurryThis(''.charAt);\nvar $parseFloat = global.parseFloat;\nvar Symbol = global.Symbol;\nvar ITERATOR = Symbol && Symbol.iterator;\nvar FORCED = 1 / $parseFloat(whitespaces + '-0') !== -Infinity\n  // MS Edge 18- broken with boxed symbols\n  || (ITERATOR && !fails(function () { $parseFloat(Object(ITERATOR)); }));\n\n// `parseFloat` method\n// https://tc39.es/ecma262/#sec-parsefloat-string\nmodule.exports = FORCED ? function parseFloat(string) {\n  var trimmedString = trim(toString(string));\n  var result = $parseFloat(trimmedString);\n  return result === 0 && charAt(trimmedString, 0) == '-' ? -0 : result;\n} : $parseFloat;\n"],"sourceRoot":""}